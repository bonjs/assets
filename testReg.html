<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	</head>
	<body>
		
		<script>
			var html = '<div><each arr1="user" index=i><img></each></div>';
			var reg = /<each([^>]+)>/g;
			var html2 = html.replace(reg, function(x, a, b, c) {
				var r = /(\w+)="*(\w+)"*/g;
				var arr,indexVar, arrVar, itemVar;
				while(arr = r.exec(a)) {
					if(arr[1] == 'index') {
						indexVar = arr[2];
					} else {
						arrVar = arr[1];
						itemVar = arr[2];
					}
				}
				return '{ ' + arrVar + '.map(function(' + itemVar + ', ' + indexVar + ') { return ';
			}).replace(/<\/each>/g, ' })}  ').replace(/\n/g, '');
			console.log(html2);
			
		</script>	
	</body>
</html>